# 記事一覧リデザイン + 無限スクロール 要件仕様書

> Brainstorm session: 2026-02-11
> Status: 要件定義完了 → 設計待ち

---

## 1. 背景と目的

### 現状の課題
- 記事一覧が**テキストのみの縦積みリスト**で、ビジュアル的にしょぼい
- `og_image_url` がAPIレスポンスに含まれているが**フロントエンドで未使用**
- ページネーション/無限スクロールが**未実装**（初回20件 + SSE新着のみ）
- 画像あり/なしの記事が**同一デザイン**で表示される

### ゴール
- Dezeen（https://www.dezeen.com/）に触発された**モダンでクールなデザイン**
- 画像の有無によって**適応的にカード表示を切り替え**
- **無限スクロール**によるシームレスな閲覧体験

### デザインリファレンス
- **Dezeen**: 2カラムグリッド、画像ファースト、ミニマルなモノトーン
- ただし画像が大きすぎるため、テック記事に合った中程度のサイズ感にする
- 情報密度はDezeenより高め（テック記事はテキスト情報が重要）

---

## 2. 機能要件

### FR-1: ミックスレイアウト

**ヒーローセクション（先頭）**
- 最新記事のうち `og_image_url` がある記事を最大2件、ヒーローとして大きく表示
- ヒーローカードは1カラム幅（フル幅）または2カラムで並列表示
- 画像あり記事がない場合はヒーローセクションをスキップし、通常グリッドから開始

**通常グリッド（以降）**
- デスクトップ: 2〜3カラムのレスポンシブグリッド
- カード内の画像あり/なしに応じて高さは可変（Masonry的な見た目ではなく、行ごとに揃えるか自然な流れ）

### FR-2: アダプティブカードデザイン

**画像ありカード**
- 上部: OG画像を16:9アスペクト比で表示（`object-fit: cover`）
- 下部: タイトル（日本語）、サマリー（2-3行clamp）、メタ情報
- 画像は`next/image`で最適化（lazy load, responsive sizes）

**テキスト専用カード（画像なし）**
- 画像スペースを省略したコンパクトなカード
- タイトル + サマリー + メタ情報のみ
- 画像ありカードより低い高さになるのはOK

**共通メタ情報**
- ソース名、著者、公開日時（相対時間表示 e.g. "3時間前"）
- カテゴリタグ（小さなバッジ）

### FR-3: 無限スクロール（自動読み込み）

- ページ底部に近づくと自動的に次のページを取得
- Intersection Observer APIを使用
- ローディングインジケーター（スケルトンカードまたはスピナー）表示
- 全記事読み込み完了時は「すべての記事を表示しました」と表示
- 既存のSSEストリーミング（新着記事のリアルタイム追加）は引き続き動作

### FR-4: レスポンシブデザイン

| ブレークポイント | グリッド | ヒーロー |
|---|---|---|
| モバイル (< 768px) | 1カラム | 1カラム（フル幅） |
| タブレット (768px - 1023px) | 2カラム | 2カラム |
| デスクトップ (≥ 1024px) | 2-3カラム ミックス | 2カラム or フル幅 |

---

## 3. 非機能要件

### NFR-1: パフォーマンス
- 画像の遅延読み込み（`next/image` の `loading="lazy"`)
- 無限スクロールのページサイズは既存の20件/ページを維持
- スケルトンUIで体感速度を改善

### NFR-2: アクセシビリティ
- セマンティックHTML (`<article>`, `<time>`, `<nav>` など)
- 画像に適切な `alt` テキスト（タイトルをalt属性に）
- キーボードナビゲーション対応

### NFR-3: 互換性
- 既存のSSEストリーミング機能との共存
- 既存のAPIエンドポイントをそのまま使用（offset-based pagination: `page`, `per_page`）
- APIの変更は不要（`og_image_url` は既にレスポンスに含まれている）

---

## 4. カラースキーム

現状のグレー基調を維持し、微調整のみ:
- 背景: `bg-gray-50`（維持）
- カード: 白背景 + 繊細なボーダーまたはシャドウ
- テキスト: 現状の階層（gray-900, gray-600, gray-500）を維持
- アクセント: カテゴリタグに控えめな色（グレー系バッジを維持）
- ホバー: カードに微妙なシャドウ変化

---

## 5. ユーザーストーリー / 受け入れ基準

### US-1: ヒーロー記事表示
> ユーザーとして、トップページを開いたときに画像付きの最新記事が目を引く大きさで表示されることで、主要なニュースをすぐ把握したい。

**受け入れ基準:**
- [ ] 画像ありの最新記事が最大2件、ヒーローセクションに表示される
- [ ] ヒーロー画像は16:9で表示、`next/image`で最適化
- [ ] 画像あり記事がない場合、ヒーローセクションは非表示

### US-2: アダプティブカード
> ユーザーとして、画像がある記事はビジュアルで、ない記事はテキスト情報でスキャンしやすいカードで表示されてほしい。

**受け入れ基準:**
- [ ] `og_image_url` あり → 16:9画像 + テキスト情報のカード
- [ ] `og_image_url` なし → テキスト専用のコンパクトカード
- [ ] どちらもタイトル、サマリー（2-3行clamp）、メタ情報を含む

### US-3: 無限スクロール
> ユーザーとして、ページ遷移なく下にスクロールするだけで過去の記事を読み続けたい。

**受け入れ基準:**
- [ ] ページ底部でIntersection Observerが発火し、次の20件を自動取得
- [ ] 読み込み中にローディング表示
- [ ] 全記事表示後に終端メッセージ
- [ ] SSE新着記事はリストの先頭に追加され続ける

### US-4: レスポンシブ対応
> ユーザーとして、スマホでもタブレットでもPCでも快適に記事一覧を閲覧したい。

**受け入れ基準:**
- [ ] モバイル: 1カラム
- [ ] タブレット: 2カラム
- [ ] デスクトップ: ミックスレイアウト（ヒーロー + 2-3カラムグリッド）

---

## 6. 影響範囲（変更対象ファイル）

### フロントエンド（変更）
| ファイル | 変更内容 |
|---|---|
| `components/ArticleCard.tsx` | アダプティブカードに全面改修 |
| `components/ArticleListLive.tsx` | 無限スクロール + ミックスレイアウト |
| `app/page.tsx` | ヒーローセクション対応 |
| `app/articles/page.tsx` | 同上 |
| `app/globals.css` | 必要に応じて追加スタイル |

### フロントエンド（新規の可能性）
| ファイル | 内容 |
|---|---|
| `components/HeroSection.tsx` | ヒーローセクション専用コンポーネント |
| `components/ArticleGrid.tsx` | グリッドレイアウト管理 |
| `hooks/useInfiniteScroll.ts` | Intersection Observer + fetch ロジック |

### API（変更なし）
- 既存のoffset-based pagination (`page`, `per_page`) をそのまま使用
- `og_image_url` は既にレスポンスに含まれている

---

## 7. オープンな質問

1. **ヒーローの画像が2件とも同じ出典の場合**: そのまま表示？ → 初期実装ではロジックはシンプルに（最新2件の画像あり記事）
2. **画像のfallback**: OG画像URLが404の場合の処理 → `next/image`の`onError`でテキスト専用カードにフォールバック
3. **無限スクロールとSSEの共存**: 新着記事がSSEで追加された場合、次のページfetchでの重複排除 → IDベースで重複チェック

---

## 8. 次のステップ

1. `/sc:design` → アーキテクチャ・コンポーネント設計
2. `/sc:implement` → 実装
3. `/sc:test` → テスト
